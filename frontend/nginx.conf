worker_processes auto;
events {}
http {
    upstream api {
        server streye-backend:3000;
    }

    server {
        listen 80;
        
        location / {
            auth_basic "Admin area";
            auth_basic_user_file /etc/nginx/.htpasswd; 
            root /data/www;
        }

        location /tv/ { 
            root /tmp/hls/; 
        }
        
        location /api/ {
            auth_basic "Admin area";
            auth_basic_user_file /etc/nginx/.htpasswd; 
            proxy_pass http://api/;
            proxy_set_header Host $http_host;
        }
    }

    types {
        application/vnd.apple.mpegurl m3u8;
        video/mp2t ts;
        text/html html;
    }
}

rtmp { 
    server { 
        listen 1935; 
        application live { 
            live on; 
            interleave on;
        
            hls on; 
            hls_path /tmp/hls/tv; 
            hls_fragment 15s; 

            record all;
            record_path /tmp/rec;
            record_unique on;
        } 
    } 
} 
 